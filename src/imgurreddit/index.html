<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>ImguReddit</title>
    </head>
    <body>
        <p>The bookmarklet: &rarr; 
<a href='' id='bookmarklet'>ImgurRedit</a> &larr; (drag this to your bookmarks bar, or right-click and "bookmark this")</p>
        <p>When you're <a href='http://reddit.com/'>on reddit</a>, click the bookmarklet, and in come the images.</p>
    </body>
    <script type='text/javascript'>
        var src = ['javascript:void((function($) {',
                  'var v = [];',
                  '$("a").each(function(i,e){',
                      'var h = $(e).attr("href");',
                      'var src;',
                      'if (h && $.inArray(h.split(".").pop().toLowerCase(), ["gif", "jpg", "jpeg", "png"]) != -1) {', 
                          'src=h;',
                      '} else if (h && h.indexOf("imgur") != -1) {',
                          'src=h+".jpg";',
                      '}',
                      'if (src && $.inArray(src, v) == -1){',
                          'var img = $("<img/>").attr("src",src);',
                          '$(img).load(function() {',
                              'var x = $(this).width();',
                              'if (x > 800) {',
                                  '$(this).css({"width":"800px","height":$(this).height()/x*800+"px"});',
                              '}',
                              '$(this).show();',
                          '});',
                          '$(e).before($("<a/>").attr("href", h).append(img, "<br/>"));',
                          'v.push(src);',
                      '}',
                  '})',
              '})(jQuery))'].join("");
        document.getElementById('bookmarklet').href = src;
    </script>
</html>
